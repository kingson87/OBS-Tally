#!/bin/bash

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
APP_DIR="$(dirname "$(dirname "$SCRIPT_DIR")")"
PROJECT_DIR="$APP_DIR"

# Change to project directory
cd "$PROJECT_DIR"

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    osascript -e 'display alert "Node.js Required" message "Please install Node.js from nodejs.org to run OBS Tally." buttons {"OK"} default button "OK"'
    exit 1
fi

# Check if dependencies are installed
if [ ! -d "node_modules" ]; then
    osascript -e 'display alert "Installing Dependencies" message "First time setup - installing required packages..." buttons {"OK"} default button "OK"'
    npm install
fi

# Start the server
echo "Starting OBS Tally Server..."
node index.js &
SERVER_PID=$!

# Wait a moment for server to start
sleep 2

# Open the web interface
open "http://localhost:3005"

# Show notification
osascript -e 'display notification "OBS Tally is now running at http://localhost:3005" with title "OBS Tally Started"'

# Keep the app running
wait $SERVER_PID
